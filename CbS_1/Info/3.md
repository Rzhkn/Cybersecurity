*Типы трафика*
- `Unicast` - одноадресная рассылка (один отправитель, один получатель)
- `Broadcast` - широковещательная рассылка (один отправитель, получатель - все устройства в широковещательном сегменте)
- `Multicast` - многоадресная рассылка (один отправитель, много получателей)

||Unicast|Broadcast|Multicast|
|:---|:---:|:---------:|:---------:|
| Целевая аудитория | Одно конкретное устройство | Все устройства в сети | Заинтересованные устройства |
| Нагрузка на сеть | Минимальная - т.к пакет отправляеся напряму от отправителя к получателю | Высокая - т.к пакет отправляется всем устройствам, даже если он им не нужен | Низкая - т.к пакет отправляется только заинтересованным устройствам |
| Адресация | Используются уникальные адреса | Используются специальные адреса | Используются специальные адреса |
| - IP | Уникальный IP-адрес получателя (Например: 192.168.1.10) | 255.255.255.255 (локальный) или <сеть>.255 (направленный) | Диапозон с 224.0.0.0-239.255.255.255 |
| - MAC | Уникальный MAC-адрес (Например: 00:1A:2B:3C:4D:5E) | FF:FF:FF:FF:FF:FF | Преобразуется из multicast IP-адреса (Например: 01:00:5E:XX:XX:XX) |
| Пример использования | HTTP-запрос | ARP-запрос | Телевещание |

---

*Два основных принципа multicast-рассылки:*
- Отправитель посылает только один экземпляр пакета, независимо от количества получателей
- Пакет получают только заинтересованные в нем пользователи

---
Для доставки multicast-запросов используется множество протоколов, на данный момент рассмотрим два:
- PIM - формирует путь мультикастового трафика от отправителя к получателям через маршрутизаторы
- IGMP - с помощью него, получатели сообщают ближацшим маршрутизаторам, что хотят получать трафик
---
*IGMP (Internet Group Management Protocol):*
- Первым делом маршрутизатор отправляет свой IGMP General Query после включения IGMP на его интерфейсе, чтобы узнать, есть ли получатели и заявить о своём желании быть Querier (Querier становится маршрутизатор с наименьшим IP)
- При подключении к группе 224.2.2.4, клиент отправяет свой IGMP Report. После чего начинает получать трафик
- Периодически (раз в минуту) маршрутизатор проверяет, что получатели по-прежнему есть, с помощью IGMP General Query, а узел подтверждает это с помощью IGMP Report.
- Получатель может отказаться от группы, отправив IGMP Leave.
- Маршрутизатор получив Leave должен убедиться, что больше никаких других получателей нет. Он посылает IGMP Group Specific Query… дважды. И по истечении таймера перестаёт передавать трафик
- Однако передавать IGMP Query в сеть он по-прежнему продолжает. Например, на тот случай, если плеер не  был отключен, а просто где-то со связью проблемы. Потом связь восстанавливается, но клиент-то Report не посылает сам по себе. А вот на Query отвечает. Таким образом поток может восстановиться без участия человека.

---
*PIM (Protocol Independent Multicast):*
PIM имеет две версии, которые можно даже назвать двумя различными протоколами в принципе, уж сильно они разные:
- PIM Dense Mode (DM)
- PIM Sparse Mode (SM)

*PIM Dense Mode:*



---
*Настройка multicast на двух маршрутизаторах (R1, R2):*

Первоначальная настройка R1:
```
conf t
int f0/0
ip add 10.1.1.1 255.255.255.0
no shut
end
```

Первоначальная настройка R2:
```
conf t
int f0/0
ip add 10.1.1.2 255.255.255.0
no shut
end
```

Настройка PIM-SM на R1:
```
conf t
ip multicast-routing
int f0/0
ip pim sparse-mode
end
conf t
ip pim rp-address 10.1.1.1
end
```

Настройка PIM-SM на R2:
```
conf t
ip multicast-routing
int f0/0
ip pim sparse-mode
end
conf t
ip pim rp-address 10.1.1.1
end
```

Подключение R2 к multicast-группе:
```
conf t
int f0/0
ip igmp join-group 224.2.2.4
end
```